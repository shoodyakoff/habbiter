# Supabase Settings - ะัะพะฒะตัะบะฐ ะฝะฐัััะพะตะบ Auth ะดะปั ะผัะปััะธ-ะดะตะฒะฐะนั ะฐะฒัะพัะธะทะฐัะธะธ

## ๐ฏ ะฆะตะปั

ะฃะฑะตะดะธัััั, ััะพ Supabase ะฝะฐัััะพะตะฝ ะดะปั ะฟะพะดะดะตัะถะบะธ ะผะฝะพะถะตััะฒะตะฝะฝัั ัะตััะธะน ะฟะพะปัะทะพะฒะฐัะตะปั (ะฐะฒัะพัะธะทะฐัะธั ั ัะฐะทะฝัั ััััะพะนััะฒ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ).

---

## ๐ ะะฐะบ ะพัะบัััั ะฝะฐัััะพะนะบะธ

### ะะฐัะธะฐะฝั 1: ะงะตัะตะท Dashboard
1. ะัะบัะพะนัะต [Supabase Dashboard](https://supabase.com/dashboard)
2. ะัะฑะตัะธัะต ะฟัะพะตะบั **"habbiter"**
3. ะ ะปะตะฒะพะผ ะผะตะฝั: **Authentication** โ **Configuration** โ **Sessions**

### ะะฐัะธะฐะฝั 2: ะััะผะฐั ัััะปะบะฐ
```
https://supabase.com/dashboard/project/[PROJECT_REF]/auth/sessions
```

ะะดะต `[PROJECT_REF]` - ััะพ ัะฝะธะบะฐะปัะฝัะน ID ะฒะฐัะตะณะพ ะฟัะพะตะบัะฐ (ะผะพะถะฝะพ ะฝะฐะนัะธ ะฒ URL ะธะปะธ ะฒ Project Settings).

---

## โ ะัะธัะธัะตัะบะธะต ะฝะฐัััะพะนะบะธ

### 1. Single Session Per User

**ะขะตะบััะตะต ะทะฝะฐัะตะฝะธะต ะดะพะปะถะฝะพ ะฑััั:** โ **DISABLED (ะฒัะบะปััะตะฝะพ)**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Single session per user         [OFF]      โ
โ                                             โ
โ Enable this option to allow only one       โ
โ active session per user. When this is      โ
โ enabled, signing in on a new device will   โ
โ automatically terminate previous sessions. โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะพัะตะผั:** ะัะปะธ ะฒะบะปััะตะฝะพ, ัะพ ะฟัะธ ะฒัะพะดะต ั ะฝะพะฒะพะณะพ ััััะพะนััะฒะฐ ััะฐััะต ัะตััะธะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะฒะตััะฐัััั - ััะพ ะธะผะตะฝะฝะพ ัะฐ ะฟัะพะฑะปะตะผะฐ, ะบะพัะพััั ะผั ัะตัะฐะตะผ!

**ะงัะพ ะดะตะปะฐัั ะตัะปะธ ะฒะบะปััะตะฝะพ:**
1. ะะฐะถะผะธัะต ะฝะฐ ะฟะตัะตะบะปััะฐัะตะปั, ััะพะฑั ะฒัะบะปััะธัั
2. ะะฐะถะผะธัะต "Save" (ะกะพััะฐะฝะธัั) ะฒะฝะธะทั ัััะฐะฝะธัั
3. ะะพะดะพะถะดะธัะต 1-2 ะผะธะฝััั ะดะปั ะฟัะธะผะตะฝะตะฝะธั ะฝะฐัััะพะตะบ

---

### 2. Session Inactivity Timeout

**ะะตะบะพะผะตะฝะดัะตะผะพะต ะทะฝะฐัะตะฝะธะต:** `Disabled` ะธะปะธ `>= 7 days`

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Session Inactivity Timeout                 โ
โ                                             โ
โ [Disabled] โผ                                โ
โ                                             โ
โ Terminate sessions that haven't been       โ
โ refreshed within the timeout duration.     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะพัะตะผั:** ะกะปะธัะบะพะผ ะบะพัะพัะบะธะน timeout ะผะพะถะตั ะฟัะธะฒะพะดะธัั ะบ ัะฐัััะผ ัะฐะทะปะพะณะธะฝะธะฒะฐะฝะธัะผ ะฝะตะฐะบัะธะฒะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน.

---

### 3. Maximum Session Duration

**ะะตะบะพะผะตะฝะดัะตะผะพะต ะทะฝะฐัะตะฝะธะต:** `Disabled` ะธะปะธ `>= 7 days`

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Maximum Session Duration                   โ
โ                                             โ
โ [Disabled] โผ                                โ
โ                                             โ
โ Terminate sessions after a fixed duration. โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะพัะตะผั:** ะะพ ัะผะพะปัะฐะฝะธั ะปัััะต ะพััะฐะฒะธัั ะฒัะบะปััะตะฝะฝัะผ, ััะพะฑั ะฝะต ะฑัะปะพ ะถะตััะบะธั ะปะธะผะธัะพะฒ.

---

## โ๏ธ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะฝะฐัััะพะนะบะธ (Advanced)

### JWT Expiration Time

**ะะดะต ะฝะฐะนัะธ:** Authentication โ Configuration โ **Advanced Settings** (ะฒะฝะธะทั ัััะฐะฝะธัั)

**ะขะตะบััะตะต ะทะฝะฐัะตะฝะธะต:** ะะฑััะฝะพ `3600` ัะตะบัะฝะด (1 ัะฐั)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ JWT Expiration Time                        โ
โ                                             โ
โ [3600] seconds                              โ
โ                                             โ
โ Token validity duration in seconds.        โ
โ Default: 3600. Maximum: 604800 (one week). โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะฐะถะฝะพ:**
- ะะธะฝะธะผัะผ ัะตะบะพะผะตะฝะดะพะฒะฐะฝะฝัะน: **300 ัะตะบัะฝะด (5 ะผะธะฝัั)**
- ะะฐะบัะธะผัะผ: **604800 ัะตะบัะฝะด (7 ะดะฝะตะน)**
- ะะต ัะตะบะพะผะตะฝะดัะตััั ััะฐะฒะธัั < 5 ะผะธะฝัั

**ะะพัะตะผั ััะพ ะฒะฐะถะฝะพ:**
ะกะตััะธะธ ะฟัะพะฒะตัััััั ัะพะปัะบะพ ะฟัะธ ะธััะตัะตะฝะธะธ JWT ัะพะบะตะฝะฐ. ะัะปะธ JWT ะถะธะฒะตั 1 ัะฐั, ัะพ ะธะทะผะตะฝะตะฝะธั ะฒ ะฝะฐัััะพะนะบะฐั (ะฝะฐะฟัะธะผะตั, ะฒะบะปััะตะฝะธะต "Single session") ะฟัะธะผะตะฝัััั ัะพะปัะบะพ ัะตัะตะท 1 ัะฐั ะฟะพัะปะต ะฟะพัะปะตะดะฝะตะณะพ ะฒัะพะดะฐ.

---

## ๐ ะัะพะฒะตัะบะฐ ัะตัะตะท SQL

ะะพัะปะต ะธะทะผะตะฝะตะฝะธั ะฝะฐัััะพะตะบ ะผะพะถะฝะพ ะฟัะพะฒะตัะธัั ัะตะทัะปััะฐั ัะตัะตะท SQL Editor:

```sql
-- ะัะพะฒะตัะธัั ะฐะบัะธะฒะฝัะต ัะตััะธะธ ั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
SELECT
  u.email,
  COUNT(s.id) as active_sessions,
  MAX(s.created_at) as last_session_created
FROM auth.users u
LEFT JOIN auth.sessions s ON s.user_id = u.id
WHERE u.email LIKE '%@telegram.user'
GROUP BY u.id, u.email
HAVING COUNT(s.id) > 0
ORDER BY active_sessions DESC
LIMIT 20;
```

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั ะฟะพัะปะต ัะธะบัะฐ:**
- ะะพะปัะทะพะฒะฐัะตะปะธ ั > 1 ะฐะบัะธะฒะฝะพะน ัะตััะธะตะน - ััะพ ะฝะพัะผะฐะปัะฝะพ โ
- ะะทะฝะฐัะฐะตั, ััะพ ะพะฝะธ ะทะฐะปะพะณะธะฝะตะฝั ั ะฝะตัะบะพะปัะบะธั ััััะพะนััะฒ

---

## โ๏ธ ะะฐะถะฝะฐั ะธะฝัะพัะผะฐัะธั

### ะัะธะผะตะฝะตะฝะธะต ะฝะฐัััะพะตะบ

ะกะพะณะปะฐัะฝะพ [ะพัะธัะธะฐะปัะฝะพะน ะดะพะบัะผะตะฝัะฐัะธะธ Supabase](https://supabase.com/docs/guides/auth/sessions):

> Sessions are not proactively destroyed when you change these settings, but rather the check is enforced whenever a session is refreshed next.

**ะะตัะตะฒะพะด:** ะกะตััะธะธ ะะ ัะฝะธััะพะถะฐัััั ััะฐะทั ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ะฝะฐัััะพะตะบ. ะัะพะฒะตัะบะฐ ะฟัะธะผะตะฝัะตััั ัะพะปัะบะพ ะฟัะธ ัะปะตะดัััะตะผ refresh ัะพะบะตะฝะฐ (ั.ะต. ะบะพะณะดะฐ ะธััะตะบะฐะตั JWT).

**ะญัะพ ะทะฝะฐัะธั:**
- ะัะปะธ JWT expiration = 1 ัะฐั, ัะพ ัััะตะบั ะพั ะธะทะผะตะฝะตะฝะธั ะฝะฐัััะพะตะบ ะฑัะดะตั ะฒะธะดะตะฝ ัะตัะตะท ~1 ัะฐั
- ะกัะฐััะต ัะตััะธะธ ะฟัะพะดะพะปะถะฐั ัะฐะฑะพัะฐัั ะดะพ ะธััะตัะตะฝะธั ะธั JWT
- ะะพะฒัะต ัะตััะธะธ ะฑัะดัั ัะพะทะดะฐะฒะฐัััั ัะถะต ั ะฝะพะฒัะผะธ ะฟัะฐะฒะธะปะฐะผะธ

---

## ๐ ะงะตะบ-ะปะธัั ะฟัะพะฒะตัะบะธ

ะะตัะตะด ะฝะฐัะฐะปะพะผ ัะตัะฐะบัะพัะธะฝะณะฐ ะบะพะดะฐ ัะฑะตะดะธัะตัั:

- [ ] ะัะบััะป ัััะฐะฝะธัั Sessions ะฒ Supabase Dashboard
- [ ] **"Single session per user" = DISABLED** โ
- [ ] "Session Inactivity Timeout" = Disabled ะธะปะธ >= 7 days
- [ ] "Maximum Session Duration" = Disabled ะธะปะธ >= 7 days
- [ ] JWT Expiration Time >= 300 ัะตะบัะฝะด (ะฟัะพะฒะตัะธะป ะฒ Advanced Settings)
- [ ] ะะฐะถะฐะป "Save" ะตัะปะธ ััะพ-ัะพ ะผะตะฝัะป
- [ ] ะัะฟะพะปะฝะธะป SQL ะทะฐะฟัะพั ะดะปั baseline ะผะตััะธะบ
- [ ] ะะฐะฟะธัะฐะป ัะตะทัะปััะฐัั (ะบะพะปะธัะตััะฒะพ ะฐะบัะธะฒะฝัั ัะตััะธะน ัะตะนัะฐั)

---

## ๐ Troubleshooting

### ะัะพะฑะปะตะผะฐ: ะะต ะผะพะณั ะฝะฐะนัะธ Sessions ะฝะฐัััะพะนะบะธ

**ะะตัะตะฝะธะต:**
1. ะฃะฑะตะดะธัะตัั, ััะพ ะฒั ะฒ ะฟัะฐะฒะธะปัะฝะพะผ ะฟัะพะตะบัะต
2. ะััั: Dashboard โ Authentication (ะฒ ะปะตะฒะพะผ ะผะตะฝั) โ Configuration (ะฒะบะปะฐะดะบะฐ ัะฒะตััั) โ Sessions (ะฒ ะฑะพะบะพะฒะพะผ ะผะตะฝั)

### ะัะพะฑะปะตะผะฐ: ะะพัะปะต ะฒัะบะปััะตะฝะธั "Single session" ะฒัะต ัะฐะฒะฝะพ ัะฐะทะปะพะณะธะฝะธะฒะฐะตั

**ะะพะทะผะพะถะฝัะต ะฟัะธัะธะฝั:**
1. ะะฐัััะพะนะบะธ ะตัะต ะฝะต ะฟัะธะผะตะฝะธะปะธัั (ะฟะพะดะพะถะดะธัะต ะดะพ ะธััะตัะตะฝะธั JWT, ะพะฑััะฝะพ ~1 ัะฐั)
2. ะัะพะฑะปะตะผะฐ ะฒ ะบะพะดะต (ัะพะทะดะฐะตััั ะผะฝะพะณะพ ะปะธัะฝะธั ัะตััะธะน) - ะฝัะถะตะฝ ัะตัะฐะบัะพัะธะฝะณ
3. ะัะพะฑะปะตะผะฐ ั refresh token rotation - ะฟัะพะฒะตัััะต ะปะพะณะธ Edge Functions

**ะะตะนััะฒะธั:**
1. ะะพะดะพะถะดะธัะต 1-2 ัะฐัะฐ ะฟะพัะปะต ะธะทะผะตะฝะตะฝะธั ะฝะฐัััะพะตะบ
2. ะัะพะฒะตัััะต SQL ะทะฐะฟัะพัะพะผ ะบะพะปะธัะตััะฒะพ ัะตััะธะน
3. ะัะปะธ ะฟัะพะฑะปะตะผะฐ ะพััะฐะตััั - ะฟะตัะตัะพะดะธัะต ะบ ัะตัะฐะบัะพัะธะฝะณั ะบะพะดะฐ (ัะผ. [IMPLEMENTATION_CHECKLIST.md](IMPLEMENTATION_CHECKLIST.md))

---

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะพ

- [ะัะธัะธะฐะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั Supabase - User Sessions](https://supabase.com/docs/guides/auth/sessions)
- [ะะฐัะต ะฟะพะปะฝะพะต ะขะ](Technical_Specification.md)
- [ะงะตะบ-ะปะธัั ัะตะฐะปะธะทะฐัะธะธ](IMPLEMENTATION_CHECKLIST.md)
