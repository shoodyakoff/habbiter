# Habiter — Бизнес-требования

**Дата:** 2026-01-10
**Автор:** Trae

---

## Связанные документы
- **Контекст проекта:** [Project_Context.md](doc/Project_Context.md)

## История изменений
- 2026-01-10 - Документ создан

---

## 1. Проблема

### Пользователь
Telegram Power Users и Self-Improvers, которые хотят настроить гибкое расписание для своих привычек.

### Jobs To Be Done
**Когда** пользователь планирует привычки, которые не нужно выполнять каждый день (например, "Спортзал" пн/ср/пт или "Уборка" по субботам),
**Пользователь хочет** указать конкретные дни недели для выполнения этой привычки,
**Чтобы** не видеть неактуальные задачи в списке на сегодня и не портить статистику пропущенными днями.

### Текущее состояние
Сейчас все привычки создаются как "ежедневные" (по умолчанию) или имеют поле `frequency`, которое в интерфейсе, вероятно, не используется или работает некорректно. Пользователь видит привычку каждый день, даже если не планировал её делать.

---

## 2. Бизнес-цели и метрики

### Главная цель
Увеличить Retention и Daily Active Users (DAU) за счет снижения когнитивной нагрузки — пользователь видит только то, что должен сделать сегодня.

### Метрики успеха

**Первичная метрика:**
- Название: % привычек с кастомным расписанием
- Текущее значение: 0% (функционал не используется)
- Целевое значение: 15-20% привычек будут иметь настройку дней недели

**Вторичные метрики:**
- Completion Rate (процент выполнения запланированных привычек) — должен вырасти, так как пропадут "ложные" пропуски.

### Нефункциональные требования
- **Удобство:** Настройка дней недели должна быть простой и интуитивной (в 2-3 клика).

### Не является целью
- Сложные расписания (например, "каждое 3-е число месяца" или "раз в 2 недели"). Только дни недели.

---

## 3. Сценарии использования

### Основной сценарий (Happy Path)

**Актор:** Пользователь
**Цель:** Создать привычку "Спортзал" только на Пн, Ср, Пт.

**Шаги:**
1. Пользователь нажимает "Создать привычку" (или редактирует существующую).
2. В форме видит настройку "Частота" / "Дни недели".
3. Выбирает "Выбрать дни" (вместо "Каждый день").
4. Отмечает: Пн, Ср, Пт.
5. Сохраняет привычку.
6. **Результат:**
    - В понедельник привычка видна на главном экране.
    - Во вторник привычка СКРЫТА с главного экрана.
    - Статистика учитывает только целевые дни.

### Альтернативные сценарии

**Сценарий 2: Изменение расписания**
Пользователь понимает, что теперь ходит в зал еще и в Субботу. Заходит в редактирование -> добавляет Сб -> сохраняет. Расписание обновляется.

### Error cases (граничные случаи)

**Ситуация 1:** Пользователь снял выделение со всех дней недели.
**Ожидаемое поведение:** Валидация не должна дать сохранить привычку без дней (минимум 1 день должен быть выбран). Либо автоматически переключать на "Каждый день".

**Ситуация 2:** Просмотр статистики за прошлые периоды.
**Ожидаемое поведение:** Если привычка была выполнена в день, который сейчас исключен из расписания (изменили настройки), исторические данные должны сохраниться и отображаться.

---

## 4. Ограничения

### Технические ограничения
- База данных уже имеет поля `frequency` и `repeatDays` (массив чисел), нужно использовать их.
- `repeatDays` скорее всего хранит дни как 0-6 (Вс-Сб) или 1-7 (Пн-Вс). Нужно проверить формат `date-fns` или используемой библиотеки.

### Бизнесовые ограничения
- Нет жесткого дедлайна, но фича блокирует корректный трекинг.

### Риски и допущения
- **Допущение 1:** Мы считаем, что `frequency: 'specific_days'` в схеме БД уже поддерживается бэкендом (или нужно проверить миграции/типы). Судя по схеме `zod` — поля есть.

---

## 5. Приоритеты

### Must Have (критично для релиза)
- [ ] Выбор дней недели в форме создания/редактирования (UI).
- [ ] Фильтрация списка привычек на Главном экране (показывать только если `today` входит в `repeatDays`).
- [ ] Валидация (минимум 1 день).

### Should Have (важно, но можно отложить)
- [ ] Визуальная индикация расписания в списке "Мои привычки" (например, иконки "Пн, Ср").

### Nice to Have (если успеем)
- [ ] Учет расписания при подсчете стриков (пропуск "нерабочего" дня не сбрасывает стрик).

### Won't Have (точно НЕ в этом релизе)
- [ ] Сложные интервалы (раз в 2 недели).
- [ ] Напоминания, привязанные к конкретным дням (пока уведомления общие).

---

## 6. Критерии приемки (Acceptance Criteria)

**[Требование 1]: Форма создания/редактирования**
- [ ] Есть переключатель "Каждый день" / "Выбрать дни".
- [ ] При выборе "Выбрать дни" появляются 7 кнопок (Пн-Вс).
- [ ] Нельзя сохранить, если не выбран ни один день.

**[Требование 2]: Главный экран**
- [ ] Если сегодня Вторник, а привычка настроена на Пн, Ср — она НЕ отображается в списке.
- [ ] Если сегодня Понедельник — она отображается.

**[Требование 3]: БД и Сохранение**
- [ ] В БД сохраняется `frequency = 'specific_days'` и массив `repeatDays`.

---

## 7. Открытые вопросы

1. Как считать стрик? Если я должен делать привычку Пн, Ср, Пт. Сегодня Четверг (выходной). Стрик должен сохраняться?
   - *Предполагаемое решение:* Да, стрик не прерывается, если пропущен день, который не входит в расписание.

2. Какой формат дней недели в массиве `repeatDays`?
   - *Нужно уточнить в коде:* Обычно 0-6 (Вс-Сб) или 1-7 (ISO). `date-fns` использует 0 для воскресенья.

---

## 8. Следующие шаги

- [ ] Проектирование решения (Design.md)
- [ ] Прототипирование (если нужно)
- [ ] Написание технических требований (Technical_Specification.md)
