# Habbiter â€” Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¢Ğ— Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸

## ğŸ¯ ĞĞ±Ğ·Ğ¾Ñ€ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

**ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ:** Habbiter  
**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞœĞ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²ĞµĞ±-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞµĞº Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹ Ñ‡ĞµÑ€ĞµĞ· Telegram  
**Ğ¯Ğ·Ñ‹Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°:** Ğ ÑƒÑÑĞºĞ¸Ğ¹ (ĞºÑ€Ğ¾Ğ¼Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ "Habbiter")

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (GitHub Pages + Supabase)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           GitHub Pages (Frontend)           â”‚
â”‚  - React SPA (Vite Ğ¸Ğ»Ğ¸ Create React App)   â”‚
â”‚  - Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ (HTML, CSS, JS)       â”‚
â”‚  - NO server-side code                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ HTTPS
             â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚     Supabase (Backend)          â”‚
      â”‚                                 â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚  â”‚  Auth (Session Mgmt)    â”‚   â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â”‚                                 â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚  â”‚  PostgreSQL Database    â”‚   â”‚
      â”‚  â”‚  - users                â”‚   â”‚
      â”‚  â”‚  - habits               â”‚   â”‚
      â”‚  â”‚  - habit_records        â”‚   â”‚
      â”‚  â”‚  - subscription_checks  â”‚   â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â”‚                                 â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚  â”‚  Edge Functions         â”‚   â”‚
      â”‚  â”‚  - telegram-auth        â”‚   â”‚
      â”‚  â”‚  - check-subscription   â”‚   â”‚
      â”‚  â”‚  - telegram-webhook     â”‚   â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â”‚                                 â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚  â”‚  Storage (optional)     â”‚   â”‚
      â”‚  â”‚  - user avatars         â”‚   â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ HTTPS
                    â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   Telegram Bot API          â”‚
      â”‚   - getChatMember           â”‚
      â”‚   - sendMessage             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:**

1. **Frontend (GitHub Pages):**
   - React SPA
   - Client-side routing (React Router)
   - Supabase JS Client
   - ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ² ĞºĞ¾Ğ´Ğµ!

2. **Backend (Supabase):**
   - PostgreSQL Ğ±Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
   - Supabase Auth (ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞµÑÑĞ¸ÑĞ¼Ğ¸)
   - Edge Functions (serverless Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸)
   - Row Level Security (Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)

3. **CI/CD (GitHub Actions):**
   - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ½Ğ° GitHub Pages
   - Environment secrets (Ğ½Ğµ Ğ² ĞºĞ¾Ğ´Ğµ!)

---

## ğŸ” Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ Ğ¸ ÑĞµĞºÑ€ĞµÑ‚Ñ‹

### ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸:

1. **ĞĞ•Ğ¢ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ² ĞºĞ¾Ğ´Ğµ** âŒ
   - Telegram Bot Token â†’ Supabase Secrets
   - Channel ID â†’ Supabase Secrets
   - Database credentials â†’ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Supabase

2. **ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ ĞºĞ»ÑÑ‡Ğ¸ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ² ĞºĞ¾Ğ´Ğµ)** âœ…
   - Supabase URL â†’ `VITE_SUPABASE_URL`
   - Supabase Anon Key â†’ `VITE_SUPABASE_ANON_KEY`
   - Telegram Bot Username â†’ `VITE_TELEGRAM_BOT_USERNAME`

3. **GitHub Secrets (Ğ´Ğ»Ñ CI/CD)** ğŸ”’
   - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² GitHub Actions
   - ĞĞµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ÑÑ‚ Ğ² frontend ĞºĞ¾Ğ´

4. **Row Level Security (RLS)** ğŸ›¡ï¸
   - ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
   - Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ“Ğ´Ğµ Ñ‡Ñ‚Ğ¾ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ:

| Ğ¡ĞµĞºÑ€ĞµÑ‚ | Ğ“Ğ´Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ | ĞšĞ°Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ |
|--------|-------------|------------------|
| `TELEGRAM_BOT_TOKEN` | Supabase Secrets | Edge Functions |
| `TELEGRAM_CHANNEL_ID` | Supabase Secrets | Edge Functions |
| `SUPABASE_SERVICE_ROLE_KEY` | GitHub Secrets | CI/CD (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) |
| `SUPABASE_URL` | `.env` â†’ Frontend | ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ |
| `SUPABASE_ANON_KEY` | `.env` â†’ Frontend | ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ |

---

## ğŸ—„ï¸ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (PostgreSQL Ğ² Supabase)

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `users`

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  
  -- Telegram Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  telegram_id BIGINT UNIQUE NOT NULL,
  username TEXT,
  first_name TEXT,
  last_name TEXT,
  photo_url TEXT,
  
  -- ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°
  is_subscribed BOOLEAN DEFAULT false,
  subscription_checked_at TIMESTAMPTZ,
  subscription_expires_at TIMESTAMPTZ,
  
  -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  last_login_at TIMESTAMPTZ
);

-- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹
CREATE INDEX idx_users_telegram_id ON users(telegram_id);
CREATE INDEX idx_users_subscription_expires ON users(subscription_expires_at);

-- RLS (Row Level Security)
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

-- ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°: Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ñ ÑÑ‚Ñ€Ğ¾ĞºÑƒ
CREATE POLICY "Users can view own data"
  ON users FOR SELECT
  USING (auth.uid() = id);

-- ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°: Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ñ ÑÑ‚Ñ€Ğ¾ĞºÑƒ
CREATE POLICY "Users can update own data"
  ON users FOR UPDATE
  USING (auth.uid() = id);
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `habits`

```sql
CREATE TABLE habits (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  
  -- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºĞ¸
  name TEXT NOT NULL,
  description TEXT,
  icon TEXT NOT NULL,
  color TEXT NOT NULL,
  
  -- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
  frequency TEXT DEFAULT 'daily', -- daily, specific_days, custom
  repeat_days INTEGER[], -- [1,2,3,4,5] Ğ´Ğ»Ñ ĞŸĞ½-ĞŸÑ‚
  
  -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
  status TEXT DEFAULT 'active', -- active, archived, deleted
  archived_at TIMESTAMPTZ,
  deleted_at TIMESTAMPTZ,
  
  -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  CONSTRAINT habits_name_length CHECK (char_length(name) <= 50)
);

-- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹
CREATE INDEX idx_habits_user_id ON habits(user_id);
CREATE INDEX idx_habits_status ON habits(status);

-- RLS
ALTER TABLE habits ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own habits"
  ON habits FOR ALL
  USING (user_id IN (SELECT id FROM users WHERE auth.uid() = id));
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `habit_records`

```sql
CREATE TABLE habit_records (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  habit_id UUID REFERENCES habits(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  
  -- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
  date DATE NOT NULL,
  completed BOOLEAN DEFAULT false,
  
  -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: Ğ¾Ğ´Ğ½Ğ° Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ½Ğ° Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºÑƒ Ğ½Ğ° Ğ´ĞµĞ½ÑŒ
  CONSTRAINT habit_records_unique UNIQUE (habit_id, date)
);

-- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹
CREATE INDEX idx_habit_records_habit_id ON habit_records(habit_id);
CREATE INDEX idx_habit_records_user_id ON habit_records(user_id);
CREATE INDEX idx_habit_records_date ON habit_records(date);

-- RLS
ALTER TABLE habit_records ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own records"
  ON habit_records FOR ALL
  USING (user_id IN (SELECT id FROM users WHERE auth.uid() = id));
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `subscription_checks`

```sql
CREATE TABLE subscription_checks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  
  -- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
  is_subscribed BOOLEAN NOT NULL,
  check_method TEXT, -- 'login', 'cron', 'manual'
  status TEXT, -- 'member', 'left', 'kicked'
  error_message TEXT,
  
  -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  checked_at TIMESTAMPTZ DEFAULT NOW()
);

-- Ğ˜Ğ½Ğ´ĞµĞºÑ
CREATE INDEX idx_subscription_checks_user_id ON subscription_checks(user_id);

-- RLS
ALTER TABLE subscription_checks ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own checks"
  ON subscription_checks FOR SELECT
  USING (user_id IN (SELECT id FROM users WHERE auth.uid() = id));
```

### Database Functions (Ğ´Ğ»Ñ streak calculation)

```sql
-- Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ° streak
CREATE OR REPLACE FUNCTION calculate_streak(p_habit_id UUID)
RETURNS INTEGER AS $$
DECLARE
  current_streak INTEGER := 0;
  check_date DATE := CURRENT_DATE;
BEGIN
  -- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ½Ğ¸ Ğ½Ğ°Ğ·Ğ°Ğ´ Ğ¾Ñ‚ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ
  LOOP
    IF EXISTS (
      SELECT 1 FROM habit_records
      WHERE habit_id = p_habit_id
        AND date = check_date
        AND completed = true
    ) THEN
      current_streak := current_streak + 1;
      check_date := check_date - INTERVAL '1 day';
    ELSE
      EXIT;
    END IF;
  END LOOP;
  
  RETURN current_streak;
END;
$$ LANGUAGE plpgsql;
```

---

## âš¡ Supabase Edge Functions

### 1. Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ: `telegram-auth`

**ĞŸÑƒÑ‚ÑŒ:** `supabase/functions/telegram-auth/index.ts`

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Telegram Login Widget

**Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ:**
```typescript
POST /telegram-auth
Body: {
  id: string,
  first_name: string,
  last_name?: string,
  username?: string,
  photo_url?: string,
  auth_date: string,
  hash: string
}
```

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ hash Ğ¾Ñ‚ Telegram (HMAC-SHA256)
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑĞ²ĞµĞ¶ĞµÑÑ‚ÑŒ auth_date (< 1 Ñ‡Ğ°Ñ)
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ Ğ½Ğ° ĞºĞ°Ğ½Ğ°Ğ» (getChatMember)
4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ğ‘Ğ”
5. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Supabase Auth ÑĞµÑÑĞ¸Ñ
6. Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒ session token

**ĞÑ‚Ğ²ĞµÑ‚:**
```typescript
{
  success: true,
  isSubscribed: boolean,
  session: {
    access_token: string,
    refresh_token: string,
    user: { ... }
  }
}
```

**ĞŸÑĞµĞ²Ğ´Ğ¾ĞºĞ¾Ğ´:**
```typescript
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const TELEGRAM_BOT_TOKEN = Deno.env.get('TELEGRAM_BOT_TOKEN')!
const TELEGRAM_CHANNEL_ID = Deno.env.get('TELEGRAM_CHANNEL_ID')!

serve(async (req) => {
  const data = await req.json()
  
  // 1. Verify Telegram hash
  if (!verifyTelegramHash(data)) {
    return new Response('Invalid hash', { status: 401 })
  }
  
  // 2. Check auth_date
  if (isAuthDateExpired(data.auth_date)) {
    return new Response('Auth data expired', { status: 401 })
  }
  
  // 3. Check channel subscription
  const isSubscribed = await checkChannelSubscription(data.id)
  
  // 4. Create/update user
  const supabase = createClient(...)
  const { data: user } = await supabase
    .from('users')
    .upsert({
      telegram_id: data.id,
      username: data.username,
      first_name: data.first_name,
      is_subscribed: isSubscribed,
      subscription_checked_at: new Date(),
      subscription_expires_at: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
    })
    .select()
    .single()
  
  // 5. Create Auth session
  const { data: session } = await supabase.auth.signInWithPassword({
    email: `${data.id}@telegram.user`,
    password: TELEGRAM_BOT_TOKEN // Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ´Ğ»Ñ Ğ²ÑĞµÑ…
  })
  
  return new Response(JSON.stringify({
    success: true,
    isSubscribed,
    session
  }))
})
```

---

### 2. Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ: `check-subscription`

**ĞŸÑƒÑ‚ÑŒ:** `supabase/functions/check-subscription/index.ts`

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

**Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ:**
```typescript
POST /check-subscription
Headers: {
  Authorization: Bearer <access_token>
}
```

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ user_id Ğ¸Ğ· JWT
2. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ telegram_id Ğ¸Ğ· Ğ‘Ğ”
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ Ñ‡ĞµÑ€ĞµĞ· Telegram API
4. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ² Ğ‘Ğ”
5. Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚

**ĞÑ‚Ğ²ĞµÑ‚:**
```typescript
{
  isSubscribed: boolean,
  checkedAt: string
}
```

---

### 3. Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ: `telegram-webhook`

**ĞŸÑƒÑ‚ÑŒ:** `supabase/functions/telegram-webhook/index.ts`

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° callback Ğ¾Ñ‚ Telegram Ğ±Ğ¾Ñ‚Ğ° (ĞºĞ½Ğ¾Ğ¿ĞºĞ° "Ğ¯ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ»ÑÑ")

**Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ:**
```typescript
POST /telegram-webhook
Body: {
  update_id: number,
  callback_query?: {
    id: string,
    from: { id: number },
    data: string
  }
}
```

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ callback_query
2. Ğ•ÑĞ»Ğ¸ callback_data === 'check_subscription'
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ
4. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ answerCallbackQuery
5. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ

---

### 4. Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ: `cron-check-subscriptions`

**ĞŸÑƒÑ‚ÑŒ:** `supabase/functions/cron-check-subscriptions/index.ts`

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** ĞŸĞµÑ€Ğ¸Ğ¾Ğ´Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ğº (Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· Supabase pg_cron)

**Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ:**
```typescript
POST /cron-check-subscriptions
Headers: {
  Authorization: Bearer <cron_secret>
}
```

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ cron_secret
2. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ñ Ğ¸ÑÑ‚Ñ‘ĞºÑˆĞ¸Ğ¼ ĞºĞµÑˆĞµĞ¼
3. Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ
4. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ
5. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ ĞµÑĞ»Ğ¸ Ğ¾Ñ‚Ğ¿Ğ¸ÑĞ°Ğ»ÑÑ

---

## ğŸ¨ Frontend (React SPA Ğ½Ğ° GitHub Pages)

### Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº:

**Build Tool:** Vite  
**Framework:** React 18  
**Routing:** React Router v6  
**Styling:** Tailwind CSS  
**UI Components:** shadcn/ui (Radix UI)  
**Icons:** Phosphor Icons  
**HTTP Client:** Supabase JS Client  
**State Management:** React Context + Supabase Realtime (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:

```
habbiter/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/              # shadcn/ui ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”‚   â”œâ”€â”€ HabitCard.tsx
â”‚   â”‚   â”œâ”€â”€ ProgressBar.tsx
â”‚   â”‚   â””â”€â”€ WeekSwitcher.tsx
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx
â”‚   â”‚   â”œâ”€â”€ SubscribePage.tsx
â”‚   â”‚   â”œâ”€â”€ HabitsPage.tsx
â”‚   â”‚   â”œâ”€â”€ AnalyticsPage.tsx
â”‚   â”‚   â””â”€â”€ ProfilePage.tsx
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ supabase.ts      # Supabase client
â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â””â”€â”€ useHabits.ts
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ main.tsx
â”‚   â””â”€â”€ index.css
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ README.md
```

### ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Vite Ğ´Ğ»Ñ GitHub Pages:

**vite.config.ts:**
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  base: '/habbiter/', // Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
  build: {
    outDir: 'dist',
  },
})
```

### Environment Variables (`.env`):

```env
# ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ ĞºĞ»ÑÑ‡Ğ¸ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¸Ñ‚ÑŒ Ğ² .env.example)
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
VITE_TELEGRAM_BOT_USERNAME=habbiter_bot
VITE_TELEGRAM_CHANNEL_USERNAME=your_channel
```

### Supabase Client (`src/lib/supabase.ts`):

```typescript
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY

export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
  auth: {
    autoRefreshToken: true,
    persistSession: true,
    detectSessionInUrl: true,
  },
})
```

### Auth Hook (`src/hooks/useAuth.ts`):

```typescript
import { useEffect, useState } from 'react'
import { supabase } from '@/lib/supabase'
import type { User } from '@supabase/supabase-js'

export function useAuth() {
  const [user, setUser] = useState<User | null>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ ÑĞµÑÑĞ¸Ñ
    supabase.auth.getSession().then(({ data: { session } }) => {
      setUser(session?.user ?? null)
      setLoading(false)
    })

    // Ğ¡Ğ»ÑƒÑˆĞ°Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (_event, session) => {
        setUser(session?.user ?? null)
      }
    )

    return () => subscription.unsubscribe()
  }, [])

  return { user, loading }
}
```

### Protected Route:

```typescript
import { Navigate } from 'react-router-dom'
import { useAuth } from '@/hooks/useAuth'

export function ProtectedRoute({ children }: { children: React.ReactNode }) {
  const { user, loading } = useAuth()

  if (loading) {
    return <LoadingSpinner />
  }

  if (!user) {
    return <Navigate to="/login" replace />
  }

  return <>{children}</>
}
```

### Login Page (Ñ Telegram Widget):

```typescript
export function LoginPage() {
  useEffect(() => {
    // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Telegram Widget
    const script = document.createElement('script')
    script.src = 'https://telegram.org/js/telegram-widget.js?22'
    script.setAttribute('data-telegram-login', import.meta.env.VITE_TELEGRAM_BOT_USERNAME)
    script.setAttribute('data-size', 'large')
    script.setAttribute('data-radius', '8')
    script.setAttribute('data-auth-url', `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/telegram-auth`)
    script.setAttribute('data-request-access', 'write')
    script.async = true

    document.getElementById('telegram-login')?.appendChild(script)
  }, [])

  return (
    <div>
      <h1>Habbiter</h1>
      <div id="telegram-login" />
    </div>
  )
}
```

---

## ğŸš€ CI/CD (GitHub Actions)

### Ğ¤Ğ°Ğ¹Ğ»: `.github/workflows/deploy.yml`

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Create .env file
        run: |
          echo "VITE_SUPABASE_URL=${{ secrets.VITE_SUPABASE_URL }}" >> .env
          echo "VITE_SUPABASE_ANON_KEY=${{ secrets.VITE_SUPABASE_ANON_KEY }}" >> .env
          echo "VITE_TELEGRAM_BOT_USERNAME=${{ secrets.VITE_TELEGRAM_BOT_USERNAME }}" >> .env
          echo "VITE_TELEGRAM_CHANNEL_USERNAME=${{ secrets.VITE_TELEGRAM_CHANNEL_USERNAME }}" >> .env

      - name: Build
        run: npm run build

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './dist'

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

### GitHub Secrets (Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ² Settings â†’ Secrets):

```
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
VITE_TELEGRAM_BOT_USERNAME=habbiter_bot
VITE_TELEGRAM_CHANNEL_USERNAME=your_channel
```

---

## ğŸ“± Telegram Mini App

### Entry Point:

```typescript
// src/pages/MiniAppPage.tsx
export function MiniAppPage() {
  useEffect(() => {
    if (!window.Telegram?.WebApp) {
      console.error('Not in Telegram')
      return
    }

    const tg = window.Telegram.WebApp
    tg.ready()
    tg.expand()

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ initData
    const initData = tg.initData

    // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ° Edge Function Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
    fetch(`${supabaseUrl}/functions/v1/telegram-auth-miniapp`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ initData })
    })
      .then(res => res.json())
      .then(data => {
        if (data.isSubscribed) {
          navigate('/habits')
        } else {
          navigate('/subscribe')
        }
      })
  }, [])

  return <LoadingSpinner />
}
```

---

## ğŸ”„ ĞŸĞµÑ€Ğ¸Ğ¾Ğ´Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: Supabase pg_cron (Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹)

**SQL:**
```sql
-- Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ
CREATE EXTENSION IF NOT EXISTS pg_cron;

-- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ cron job (ĞºĞ°Ğ¶Ğ´Ğ¾Ğµ Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ Ğ² 00:00 UTC)
SELECT cron.schedule(
  'check-subscriptions-weekly',
  '0 0 * * 0',
  $$
  SELECT net.http_post(
    url := 'https://your-project.supabase.co/functions/v1/cron-check-subscriptions',
    headers := '{"Content-Type": "application/json", "Authorization": "Bearer YOUR_CRON_SECRET"}'::jsonb
  );
  $$
);
```

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: GitHub Actions Cron

**Ğ¤Ğ°Ğ¹Ğ»:** `.github/workflows/check-subscriptions.yml`

```yaml
name: Check Subscriptions

on:
  schedule:
    - cron: '0 0 * * 0' # ĞºĞ°Ğ¶Ğ´Ğ¾Ğµ Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ Ğ² 00:00 UTC
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Call Supabase Function
        run: |
          curl -X POST \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            https://your-project.supabase.co/functions/v1/cron-check-subscriptions
```

---

## ğŸ“¦ Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (package.json)

```json
{
  "name": "habbiter",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "@supabase/supabase-js": "^2.39.0",
    "@radix-ui/react-dialog": "^1.0.5",
    "@radix-ui/react-checkbox": "^1.0.4",
    "phosphor-react": "^1.4.1",
    "date-fns": "^3.0.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@vitejs/plugin-react": "^4.2.0",
    "vite": "^5.0.0",
    "tailwindcss": "^3.4.0",
    "autoprefixer": "^10.4.0",
    "postcss": "^8.4.0",
    "typescript": "^5.3.0"
  }
}
```

---

## âœ… Acceptance Criteria (Ğ´Ğ»Ñ LLM Ğ°Ğ³ĞµĞ½Ñ‚Ğ°)

### Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:

**ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½ Telegram Login Widget Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ `/login`
- [ ] ĞŸÑ€Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Edge Function `telegram-auth`
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ÑÑ hash Ğ¾Ñ‚ Telegram (HMAC-SHA256)
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° ĞºĞ°Ğ½Ğ°Ğ» Ñ‡ĞµÑ€ĞµĞ· Telegram API
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ÑÑ Supabase Auth ÑĞµÑÑĞ¸Ñ
- [ ] Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½ â†’ Ñ€ĞµĞ´Ğ¸Ñ€ĞµĞºÑ‚ Ğ½Ğ° `/habits`
- [ ] Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½ â†’ Ñ€ĞµĞ´Ğ¸Ñ€ĞµĞºÑ‚ Ğ½Ğ° `/subscribe`

**Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:**
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ²ÑĞµ 4 Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ (users, habits, habit_records, subscription_checks)
- [ ] Ğ’ĞºĞ»ÑÑ‡Ñ‘Ğ½ Row Level Security (RLS) Ğ½Ğ° Ğ²ÑĞµÑ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ…
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° (Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ° Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `calculate_streak`

**Edge Functions:**
- [ ] Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ `telegram-auth` Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾
- [ ] Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ `check-subscription` Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ
- [ ] Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ `telegram-webhook` Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ callback
- [ ] Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ `cron-check-subscriptions` Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

**Frontend:**
- [ ] ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ÑÑ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹ `npm run build`
- [ ] Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¸Ñ‚ÑÑ Ğ½Ğ° GitHub Pages
- [ ] Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· Telegram
- [ ] Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸
- [ ] Ğ—Ğ°Ñ‰Ğ¸Ñ‰Ñ‘Ğ½Ğ½Ñ‹Ğµ Ñ€Ğ¾ÑƒÑ‚Ñ‹ Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
- [ ] Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° `/subscribe` ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ÑÑ

**Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ:**
- [ ] ĞĞµÑ‚ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ² ĞºĞ¾Ğ´Ğµ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Supabase Secrets Ğ¸ GitHub Secrets)
- [ ] RLS Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½ Ğ½Ğ° Ğ²ÑĞµÑ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ…
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ÑÑ hash Ğ¾Ñ‚ Telegram
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ÑÑ ÑĞ²ĞµĞ¶ĞµÑÑ‚ÑŒ auth_date

**CI/CD:**
- [ ] GitHub Actions Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¸Ñ‚ Ğ½Ğ° GitHub Pages Ğ¿Ñ€Ğ¸ push Ğ² main
- [ ] Environment variables Ğ±ĞµÑ€ÑƒÑ‚ÑÑ Ğ¸Ğ· GitHub Secrets
- [ ] Build Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾

---

## ğŸ¯ Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ´Ğ»Ñ LLM Ğ°Ğ³ĞµĞ½Ñ‚Ğ°

### Phase 1: Database Setup

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:**
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ SQL Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
2. Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ RLS Ğ½Ğ° Ğ²ÑĞµÑ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ…
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `calculate_streak`

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
- `supabase/migrations/20250103_create_tables.sql`

---

### Phase 2: Edge Functions

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:**
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Edge Function `telegram-auth`
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° hash
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸
   - Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¸
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Edge Function `check-subscription`
   - ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ user Ğ¸Ğ· JWT
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Edge Function `telegram-webhook`
   - ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° callback
4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Edge Function `cron-check-subscriptions`
   - ĞœĞ°ÑÑĞ¾Ğ²Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ğº

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
- `supabase/functions/telegram-auth/index.ts`
- `supabase/functions/check-subscription/index.ts`
- `supabase/functions/telegram-webhook/index.ts`
- `supabase/functions/cron-check-subscriptions/index.ts`

---

### Phase 3: Frontend

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:**
1. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Vite Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Supabase client
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹:
   - LoginPage (Ñ Telegram Widget)
   - SubscribePage
   - HabitsPage (Ğ³Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¸Ğ· Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾ Ğ¢Ğ—)
   - AnalyticsPage
   - ProfilePage
4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ…ÑƒĞºĞ¸:
   - useAuth
   - useHabits
5. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³ Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ¾Ğ¹
6. Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ Supabase

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
- `src/lib/supabase.ts`
- `src/hooks/useAuth.ts`
- `src/hooks/useHabits.ts`
- `src/pages/*`
- `src/App.tsx`

---

### Phase 4: CI/CD

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:**
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ GitHub Action Ğ´Ğ»Ñ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ
2. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ build Ğ´Ğ»Ñ GitHub Pages
3. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ environment variables

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
- `.github/workflows/deploy.yml`
- `vite.config.ts`

---

## ğŸ“š Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹

### Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ:
- [Supabase Edge Functions](https://supabase.com/docs/guides/functions)
- [Supabase Auth](https://supabase.com/docs/guides/auth)
- [Supabase RLS](https://supabase.com/docs/guides/auth/row-level-security)
- [Telegram Login Widget](https://core.telegram.org/widgets/login)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [GitHub Pages](https://docs.github.com/en/pages)
- [Vite](https://vitejs.dev/)

### ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:

```bash
# Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°
npm run dev

# Build
npm run build

# Preview build
npm run preview

# Supabase CLI
supabase functions new function-name
supabase functions deploy function-name
supabase db push
```

---

## ğŸ”’ Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸

- [ ] Ğ’ÑĞµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ² Supabase Secrets Ğ¸Ğ»Ğ¸ GitHub Secrets
- [ ] ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ² ĞºĞ¾Ğ´Ğµ
- [ ] RLS Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½ Ğ½Ğ° Ğ²ÑĞµÑ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ…
- [ ] ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾
- [ ] Hash Ğ¾Ñ‚ Telegram Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ÑÑ
- [ ] auth_date Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ÑÑ Ğ½Ğ° ÑĞ²ĞµĞ¶ĞµÑÑ‚ÑŒ
- [ ] HTTPS Ğ²ĞµĞ·Ğ´Ğµ
- [ ] CORS Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾
- [ ] Rate limiting Ğ½Ğ° Edge Functions
- [ ] Input validation (Zod Ğ¸Ğ»Ğ¸ Joi)

---

*Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½: 03.01.2025*
*Ğ’ĞµÑ€ÑĞ¸Ñ: 1.0 (GitHub Pages + Supabase)*
